<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Russian Roulette</title>

<style>
body{
  margin:0;
  background:#111;
  color:white;
  font-family:Arial;
  text-align:center;
  transition:0.2s;
}

.container{
  margin-top:60px;
}

.gun{
  font-size:120px;
  transition:transform 0.6s ease;
}

.spin{
  transform:rotate(720deg);
}

button{
  padding:15px 40px;
  font-size:20px;
  margin-top:30px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  background:red;
  color:white;
}

.result{
  font-size:30px;
  margin-top:30px;
  height:40px;
}
</style>
</head>
<body>

<div class="container">
  <h1>ðŸŽ¯ Russian Roulette</h1>
  <div id="gun" class="gun">ðŸ”«</div>
  <br>
  <button id="triggerBtn">BÃ“P CÃ’</button>
  <div class="result" id="result"></div>
</div>

<script>

let isPlaying = false;
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playClick(){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "square";
  osc.frequency.setValueAtTime(600, audioCtx.currentTime);

  gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.1);
}

function playBang(){
  const bufferSize = audioCtx.sampleRate * 0.3;
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);

  for (let i = 0; i < bufferSize; i++) {
    data[i] = Math.random() * 2 - 1;
  }

  const noise = audioCtx.createBufferSource();
  noise.buffer = buffer;

  const gain = audioCtx.createGain();
  gain.gain.setValueAtTime(1, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);

  noise.connect(gain);
  gain.connect(audioCtx.destination);

  noise.start();
}

document.getElementById("triggerBtn").addEventListener("click", pullTrigger);

function pullTrigger(){

  if(isPlaying) return;
  isPlaying = true;

  const gun = document.getElementById("gun");
  const result = document.getElementById("result");
  const btn = document.getElementById("triggerBtn");

  btn.disabled = true;
  result.innerText = "";
  gun.classList.add("spin");

  setTimeout(()=>{

    let shot = Math.floor(Math.random()*6) + 1;

    if(shot === 1){

      result.innerText = "ðŸ’¥ BANG!";
      result.style.color = "red";
      document.body.style.background = "#550000";
      playBang();

    } else {

      result.innerText = "ðŸ˜®â€ðŸ’¨ Click...";
      result.style.color = "lightgreen";
      playClick();
    }

    setTimeout(()=>{
      document.body.style.background = "#111";
      result.innerText = "";
      gun.classList.remove("spin");
      btn.disabled = false;
      isPlaying = false;
    },2000);

  },600);
}

</script>

</body>
</html>
